---

- hosts: book
  sudo: yes
  tasks:
  - name: install xbps docker
    when: ansible_distribution == "void"
    xbps: pkg={{item}} state=installed
    sudo: True
    with_items:
      - git
      - rsync
      - curl
      - wget
      - cifs-utils
      - smbclient         

  - git:
     repo: https://github.com/Userbash/docker-mysql-master.git
     dest: /home/project

- hosts: file
  tasks:
  - name: Wait 300 seconds for port smb of any IP to close active connections, don't start checking for 10 seconds
    wait_for:
     host: 172.16.0.14
     port: 139
     timeout: 1
    register: smbd_port_check
    ignore_errors: yes
  - fail:
      msg: 'Samba port is open'
    when: not smbd_port_check.failed

  - name: Samba demon d'not started
    runit:
     name: smbd
     state: restarted 
    when:  smbd_port_check.failed == true
